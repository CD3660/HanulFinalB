<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="qna">



<!-- 총 글건수 조회 -->
	<select id="totalList" resultType="integer">
	select count(id) from board <include refid="searchWhere"/>
	</select>


<!-- 검색조건 -->
<sql id="searchWhere">
<choose>
	<!-- 전체  -->
	<when test=" search == 's1' "> 
	where title like '%' || #{keyword} || '%'
	or content  like '%' || #{keyword} || '%'
	or writer in ( select user_id from member where name like '%' || #{keyword} || '%' )
	</when>

	<!-- 제목  -->
	<when test=" search == 's2' ">
	where title like '%' || #{keyword} || '$'
	</when>
	
	<!-- 제목 + 내용  -->
	<when test=" search == 's3' ">
	where title like '%' || #{keyword} || '$'
	or content  like '%' || #{keyword} || '%'
	</when>
	
	<!-- 내용 -->
	<when test=" search == 's3' "> 
	where content like '%' || #{keyword} || '%'
	</when>
	
	<!-- 작성자  -->
	<when test=" search == 's4' ">
	where writer in ( select user_id from member where name like '%' || #{keyword} || '%' )
	</when>

</choose>
</sql>



<!-- 해당페이지의 10건의 정보목록 조회 -->
<select id="list" resultType="qnaVO">
select ( select count(*) form board_file f where board_id = b.id ) filecnt, b.*
from ( select b.*, name, row_number() over(order by id) no
		from board b left outer join member m on b.writer = m.user_id <include refid="searchWhere"/> ) b
where no between #{beginList} and #{endList}





order by no desc

</select>

</mapper>